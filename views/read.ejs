<% include base.ejs %>
<div id="content">
    <input type="file" id="files" name="files[]" multiple />
    <output id="list"></output>
</div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
    <script>
      function handleFileSelect(evt) {
        console.log($("#list"));
        var files = evt.target.files; // FileList object
        // Loop through the FileList
        for (var i = 0, f; f = files[i]; i++) {

          var reader = new FileReader();
          var ext = f.name.split('.').pop();
          if(ext == 'drl') {
            // Closure to capture the file information.
            reader.onload = (function(theFile) {
            return function(e) {
                // Print the contents of the file
                var span = document.createElement('span');                    
                span.innerHTML = ['<p>',e.target.result,'</p>'].join('');
                document.getElementById('list').insertBefore(span, null);
                $.post("/read",
                  {
                    contents : e.target.result
                  },
                  function(data) {
                    console.log(data.contents);
                  },
                  "json");
              };
            })(f);  
          }else{
            console.log("This is not a drools file");
            alert('I only read DRL files!');
          }
          // Read in the file
          //reader.readAsDataText(f,"UTF-8");
          reader.readAsText(f);
        }
      }

      document.getElementById('files').addEventListener('change', handleFileSelect, false);
    </script>
</body>